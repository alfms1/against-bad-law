<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>📱 모바일 북마클릿 실전 테스트</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 100%;
      margin: 0;
      padding: 15px;
      line-height: 1.6;
      background: #f8f9fa;
    }
    .container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #1976d2;
      text-align: center;
      margin-bottom: 10px;
      font-size: 24px;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 16px;
    }
    .test-step {
      background: #e3f2fd;
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
      border-left: 5px solid #1976d2;
    }
    .test-step h3 {
      margin: 0 0 15px 0;
      color: #1976d2;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .step-number {
      background: #1976d2;
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
    }
    .code-block {
      background: #2d3748;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.4;
      margin: 15px 0;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .copy-btn {
      background: #4caf50;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 10px;
      width: 100%;
      touch-action: manipulation;
    }
    .copy-btn:hover {
      background: #45a049;
    }
    .copy-btn:active {
      background: #3d8b40;
      transform: scale(0.98);
    }
    .quick-test {
      background: #fff3e0;
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
      border-left: 5px solid #ff9800;
    }
    .success {
      background: #e8f5e8;
      color: #2e7d32;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      border: 1px solid #a5d6a7;
    }
    .error {
      background: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      border: 1px solid #ef9a9a;
    }
    .warning {
      background: #fff3e0;
      color: #ef6c00;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      border: 1px solid #ffcc02;
    }
    .browser-check {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin: 20px 0;
    }
    .browser-item {
      background: white;
      padding: 15px;
      border-radius: 8px;
      border: 2px solid #e0e0e0;
      cursor: pointer;
      transition: all 0.3s;
    }
    .browser-item:hover {
      border-color: #1976d2;
      background: #f8f9fa;
    }
    .browser-item.selected {
      border-color: #4caf50;
      background: #e8f5e8;
    }
    .test-result {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      min-height: 50px;
      border: 2px dashed #ddd;
    }
    .action-btn {
      background: #ff5722;
      color: white;
      border: none;
      padding: 15px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      width: 100%;
      margin: 10px 0;
      touch-action: manipulation;
    }
    .action-btn:hover {
      background: #e64a19;
    }
    .checklist {
      background: #f0f4f8;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .checklist-item {
      display: flex;
      align-items: center;
      margin: 10px 0;
      padding: 8px;
      background: white;
      border-radius: 6px;
    }
    .checklist-item input[type="checkbox"] {
      margin-right: 10px;
      transform: scale(1.2);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>📱 모바일 북마클릿 실전 테스트</h1>
    <div class="subtitle">VForKorea 자동화 도구가 제대로 작동하는지 확인하세요</div>

    <!-- 사전 체크 -->
    <div class="quick-test">
      <h3>⚡ 빠른 준비 체크</h3>
      <div class="checklist">
        <div class="checklist-item">
          <input type="checkbox" id="check1">
          <label for="check1">모바일 브라우저에서 JavaScript가 활성화되어 있음</label>
        </div>
        <div class="checklist-item">
          <input type="checkbox" id="check2">
          <label for="check2">VForKorea.com에 접속 가능</label>
        </div>
        <div class="checklist-item">
          <input type="checkbox" id="check3">
          <label for="check3">오늘 마감 법안이 1개 이상 있음</label>
        </div>
      </div>
    </div>

    <!-- 1단계: 기본 JavaScript 테스트 -->
    <div class="test-step">
      <h3><span class="step-number">1</span>기본 JavaScript 테스트</h3>
      <p>먼저 브라우저에서 JavaScript가 작동하는지 확인합니다:</p>
      
      <button class="action-btn" onclick="testBasicJS()">🧪 기본 테스트 실행</button>
      <div id="basic-test-result" class="test-result">
        여기에 테스트 결과가 표시됩니다...
      </div>
    </div>

    <!-- 2단계: 북마클릿 코드 복사 -->
    <div class="test-step">
      <h3><span class="step-number">2</span>북마클릿 코드 준비</h3>
      <p>다음 코드를 복사하여 북마크로 저장하세요:</p>
      
      <div class="code-block" id="bookmarklet-code"></div>
      <button class="copy-btn" onclick="copyBookmarkletCode()">📋 북마클릿 코드 복사</button>
      
      <div class="warning">
        <strong>💡 모바일에서 북마크 만들기:</strong><br>
        1. 아무 페이지나 북마크로 저장<br>
        2. 북마크 편집 → URL 완전히 삭제<br>
        3. 복사한 코드 붙여넣기<br>
        4. 이름을 "VForKorea Tool"로 변경
      </div>
    </div>

    <!-- 3단계: VForKorea에서 테스트 -->
    <div class="test-step">
      <h3><span class="step-number">3</span>VForKorea 실전 테스트</h3>
      <p>VForKorea 사이트에서 북마클릿을 실행해보세요:</p>
      
      <button class="action-btn" onclick="window.open('https://vforkorea.com/assem/', '_blank')">🌐 VForKorea 열기</button>
      
      <div class="success">
        <strong>✅ 성공 시 나타나는 현상:</strong><br>
        • 화면 우상단에 "📝 오늘 마감 법안 (X건)" 패널이 나타남<br>
        • 각 법안별로 찬성/반대 버튼이 보임<br>
        • "의견 등록 시작" 버튼이 활성화됨
      </div>
      
      <div class="error">
        <strong>❌ 실패 시 확인사항:</strong><br>
        • 패널이 전혀 나타나지 않음<br>
        • 콘솔에 오류 메시지 표시<br>
        • 북마클릿 클릭해도 아무 반응 없음
      </div>
    </div>

    <!-- 4단계: 대안 테스트 (개발자 도구) -->
    <div class="test-step">
      <h3><span class="step-number">4</span>개발자 도구 대안 테스트</h3>
      <p>북마클릿이 안 되면 개발자 도구로 직접 실행:</p>
      
      <div class="code-block" id="direct-code"></div>
      <button class="copy-btn" onclick="copyDirectCode()">📋 직접 실행 코드 복사</button>
      
      <div class="warning">
        <strong>💡 개발자 도구 사용법:</strong><br>
        <strong>Kiwi Browser:</strong> 메뉴 → Developer tools → Console<br>
        <strong>Firefox:</strong> 메뉴 → 도구 → 웹 개발자 → 콘솔<br>
        <strong>Chrome (USB 디버깅):</strong> PC에서 chrome://inspect
      </div>
    </div>

    <!-- 5단계: 결과 확인 -->
    <div class="test-step">
      <h3><span class="step-number">5</span>최종 결과 확인</h3>
      <p>테스트 결과를 알려주세요:</p>
      
      <div class="browser-check">
        <div class="browser-item" onclick="reportResult('success')">
          ✅ 성공! 패널이 나타나고 정상 작동함
        </div>
        <div class="browser-item" onclick="reportResult('partial')">
          ⚠️ 부분 성공: 패널은 나타나지만 일부 기능 이상
        </div>
        <div class="browser-item" onclick="reportResult('failed')">
          ❌ 실패: 패널이 전혀 나타나지 않음
        </div>
        <div class="browser-item" onclick="reportResult('error')">
          🚨 오류: 에러 메시지 발생
        </div>
      </div>
      
      <div id="result-feedback" class="test-result"></div>
    </div>

    <!-- 추가 정보 수집 -->
    <div class="test-step">
      <h3><span class="step-number">6</span>디버깅 정보 수집</h3>
      <p>문제가 있다면 다음 정보를 확인해주세요:</p>
      
      <button class="action-btn" onclick="collectDebugInfo()">🔍 디버깅 정보 수집</button>
      <div id="debug-info" class="test-result"></div>
    </div>
  </div>

  <script>
    // 북마클릿 코드 생성
    const jsURL = 'https://alfms1.github.io/against-bad-law/vote-bookmarklet.js';
    const bookmarkletCode = `javascript:(function(){var s=document.createElement('script');s.src='${jsURL}';document.body.appendChild(s);})();`;
    const directCode = `(function(){var s=document.createElement('script');s.src='${jsURL}';document.body.appendChild(s);})();`;

    // 코드 표시
    document.getElementById('bookmarklet-code').textContent = bookmarkletCode;
    document.getElementById('direct-code').textContent = directCode;

    // 기본 JavaScript 테스트
    function testBasicJS() {
      const result = document.getElementById('basic-test-result');
      try {
        // 기본 기능 테스트
        const tests = [
          { name: 'JavaScript 실행', test: () => typeof window !== 'undefined' },
          { name: 'DOM 조작', test: () => document.createElement('div') instanceof HTMLElement },
          { name: 'LocalStorage', test: () => typeof localStorage !== 'undefined' },
          { name: '현재 도메인', test: () => window.location.hostname }
        ];

        let resultHTML = '<h4>🧪 기본 테스트 결과:</h4>';
        let allPassed = true;

        tests.forEach(({ name, test }) => {
          try {
            const result = test();
            const passed = !!result;
            allPassed = allPassed && passed;
            resultHTML += `<div style="color: ${passed ? 'green' : 'red'}; margin: 5px 0;">
              ${passed ? '✅' : '❌'} ${name}: ${passed ? (typeof result === 'string' ? result : '통과') : '실패'}
            </div>`;
          } catch (e) {
            allPassed = false;
            resultHTML += `<div style="color: red; margin: 5px 0;">❌ ${name}: 오류 - ${e.message}</div>`;
          }
        });

        resultHTML += `<div style="margin-top: 15px; padding: 10px; border-radius: 6px; background: ${allPassed ? '#e8f5e8' : '#ffebee'}; color: ${allPassed ? '#2e7d32' : '#c62828'};">
          <strong>${allPassed ? '✅ 모든 기본 테스트 통과!' : '❌ 일부 테스트 실패'}</strong>
        </div>`;

        result.innerHTML = resultHTML;
      } catch (e) {
        result.innerHTML = `<div style="color: red;">❌ 테스트 실행 중 오류: ${e.message}</div>`;
      }
    }

    // 북마클릿 코드 복사
    async function copyBookmarkletCode() {
      try {
        await navigator.clipboard.writeText(bookmarkletCode);
        showCopySuccess('북마클릿 코드가 복사되었습니다!');
      } catch (err) {
        fallbackCopy(bookmarkletCode, '북마클릿 코드가 복사되었습니다!');
      }
    }

    // 직접 실행 코드 복사
    async function copyDirectCode() {
      try {
        await navigator.clipboard.writeText(directCode);
        showCopySuccess('개발자 도구용 코드가 복사되었습니다!');
      } catch (err) {
        fallbackCopy(directCode, '개발자 도구용 코드가 복사되었습니다!');
      }
    }

    // 복사 성공 표시
    function showCopySuccess(message) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #4caf50;
        color: white;
        padding: 12px 20px;
        border-radius: 6px;
        z-index: 10000;
        font-weight: bold;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        document.body.removeChild(notification);
      }, 3000);
    }

    // 복사 대체 방법
    function fallbackCopy(text, message) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      showCopySuccess(message);
    }

    // 결과 보고
    function reportResult(type) {
      const feedback = document.getElementById('result-feedback');
      const items = document.querySelectorAll('.browser-item');
      
      // 선택 상태 업데이트
      items.forEach(item => item.classList.remove('selected'));
      event.target.classList.add('selected');

      const messages = {
        success: {
          color: '#2e7d32',
          bg: '#e8f5e8',
          title: '🎉 완벽한 성공!',
          content: '북마클릿이 정상적으로 작동합니다. VForKorea에서 자동화 도구를 사용할 수 있습니다!'
        },
        partial: {
          color: '#ef6c00',
          bg: '#fff3e0',
          title: '⚠️ 부분 성공',
          content: '기본 기능은 작동하지만 일부 개선이 필요할 수 있습니다. 어떤 부분에 문제가 있는지 알려주세요.'
        },
        failed: {
          color: '#c62828',
          bg: '#ffebee',
          title: '❌ 작동 실패',
          content: '북마클릿이 작동하지 않습니다. 개발자 도구 방법을 시도해보거나 다른 브라우저를 사용해보세요.'
        },
        error: {
          color: '#c62828',
          bg: '#ffebee',
          title: '🚨 오류 발생',
          content: '실행 중 오류가 발생했습니다. 브라우저 콘솔에서 오류 메시지를 확인해주세요.'
        }
      };

      const msg = messages[type];
      feedback.innerHTML = `
        <div style="color: ${msg.color}; background: ${msg.bg}; padding: 15px; border-radius: 8px;">
          <h4 style="margin: 0 0 10px 0;">${msg.title}</h4>
          <p style="margin: 0;">${msg.content}</p>
        </div>
      `;
    }

    // 디버깅 정보 수집
    function collectDebugInfo() {
      const debugInfo = document.getElementById('debug-info');
      try {
        const info = {
          userAgent: navigator.userAgent,
          viewport: `${window.innerWidth}x${window.innerHeight}`,
          domain: window.location.hostname,
          protocol: window.location.protocol,
          jsEnabled: typeof window !== 'undefined',
          localStorageAvailable: typeof localStorage !== 'undefined',
          touchSupport: 'ontouchstart' in window,
          timestamp: new Date().toLocaleString()
        };

        let debugHTML = '<h4>🔍 디버깅 정보:</h4>';
        Object.entries(info).forEach(([key, value]) => {
          debugHTML += `<div style="margin: 5px 0;"><strong>${key}:</strong> ${value}</div>`;
        });

        debugHTML += `
          <div style="margin-top: 15px; padding: 10px; background: #f0f4f8; border-radius: 6px;">
            <strong>📋 이 정보를 복사해서 문제 신고시 함께 제공해주세요</strong>
          </div>
        `;

        debugInfo.innerHTML = debugHTML;
      } catch (e) {
        debugInfo.innerHTML = `<div style="color: red;">❌ 디버깅 정보 수집 실패: ${e.message}</div>`;
      }
    }

    // 페이지 로드시 기본 테스트 자동 실행
    document.addEventListener('DOMContentLoaded', function() {
      // 2초 후 자동으로 기본 테스트 실행
      setTimeout(testBasicJS, 2000);
    });
  </script>
</body>
</html>
